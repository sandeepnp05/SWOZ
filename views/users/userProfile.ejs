<%- include("../layouts/header.ejs") %> <%- include("../layouts/userNav.ejs") %>
<style>
  /* CSS code to style the card-address div */
.card-address {
  background-color: #f5f5f5; /* Background color */
  border: 1px solid #ccc; /* Border */
  border-radius: 5px; /* Rounded corners */
  padding: 20px; /* Padding inside the div */
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Box shadow for a subtle elevation effect */
}

/* CSS code to style the card-title */
.card-title {
  font-size: 1.5rem; /* Font size */
  color: #333; /* Text color */
  margin-bottom: 10px; /* Margin at the bottom of the title */
}

/* Style the form elements within the card-address */
.form-group {
  margin-bottom: 15px; /* Margin between form groups */
}

/* Style the labels */
label {
  font-weight: bold; /* Bold label text */
  color: #555; /* Label text color */
}

/* Style the input fields */
.form-control {
  width: 100%; /* Make the inputs fill the entire width of their container */
  padding: 10px; /* Padding inside the input fields */
  border: 1px solid #ccc; /* Input field border */
  border-radius: 3px; /* Rounded input field corners */
}

/* Style the buttons */
.btn {
  margin-top: 10px; /* Margin at the top of buttons */
  /* You can further customize button styles as needed */
}

/* Style the hr element */
hr {
  border-color: #ccc; /* Horizontal line color */
}

</style>
<section style="background-color: #eee">
  <div class="container py-6" style="padding-top: 8rem; padding-bottom: 3rem">
    <div class="row">
      <div class="col-lg-4">
        <div class="card mb-4">
          <div class="card-body text-center">
           
            <img class="img-fluid" src="/uncroppedImages/<%=userData.image%>"
              alt="avatar"
              class="rounded-circle img-fluid"
              style="width: 150px"
            />
            <h5 class="my-3"><%=userData.firstname%> <%=userData.lastname%></h5>
            <!-- <h6>Wallet amount: User Wallet Amount</h6> -->
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <ul class="list-group list-group-flush">
              <li class="list-group-item">
                <a
                  href="#"
                  class="text-decoration-none"
                  onclick="toggleProfileForm()"
                  >Edit Profile</a
                >
              </li>
              <li class="list-group-item">
                <a href="/orderedList" class="text-decoration-none">Orders</a>
              </li>
              <li class="list-group-item">
                <a
                  href="#"
                  class="text-decoration-none"
                  onclick="toggleAddress()"
                  >Manage Address</a
                >
              </li>
              <li class="list-group-item">
                <a
                  href="/walletHistory"
                  class="text-decoration-none"
                  >Wallet History</a
                >
              </li>
              <li class="list-group-item">
                <a href="/logout" class="btn btn-primary ml-3">Logout</a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="col-lg-8">
        <div class="card mb-4" id="userDetails">
          <div class="card-body">
            <h5 class="card-title">User Profile</h5>
            <hr />
            <div class="ro">
              <div class="col-sm-3">
                <p class="mb-0">Full Name</p>
              </div>
              <div class="col-sm-9">
                <p class="text-muted mb-0">
                  <%=userData.firstname%> <%=userData.lastname%>
                </p>
              </div>
            </div>
            <hr />
            <div class="ro">
              <div class="col-sm-3">
                <p class="mb-0">Email</p>
              </div>
              <div class="col-sm-9">
                <p class="text-muted mb-0"><%=userData.email%></p>
              </div>
            </div>
            <hr />
            <div class="ro">
              <div class="col-sm-3">
                <p class="mb-0">Mobile</p>
              </div>
              <div class="col-sm-9">
                <p class="text-muted mb-0"><%= userData.phone %></p>
              </div>
            </div>
            <hr />
            <div class="ro">
              <div class="col-sm-3">
                <p class="mb-0"></p>
              </div>
              <div class="col-sm-9">
                <!-- <a
                  href="/resetPassword?token=User_ID"
                  class="btn btn-primary mr-2"
                  >Change Password</a
                > -->
                <a href="/addressForm" class="btn btn-primary">Add Address</a>
              </div>
            </div>
            <hr />
          </div>
        </div>

        <div class="card mb-4" id="profileForm" style="display: none">
          <div class="d-flex align-items-center justify-content-between">
            <h3></h3>
            
          </div>
          <div class="card-address">
            <h5 class="card-title">Update Profile</h5>
            <hr />
            <form action="/updateProfile" method="post" enctype="multipart/form-data">
              <div class="form-group">
                <label for="firstname">First Name</label>
                <input
                  type="text"
                  class="form-control"
                  name="firstname"
                  id="firstName"
                  value="<%= userData.firstname %>"
                  placeholder="Enter your first name"
                  required
                />
              </div>
              <div class="form-group">
                <label for="lastName">Last Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="lastName"
                  name="lastname"
                  value="<%=userData.lastname %>"
                  placeholder="Enter your last name"
                  required
                />
              </div>
              <div class="form-group">
                <label for="email">Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  name="email"
                  readonly
                  value="<%=userData.email %>"
                  placeholder="Enter your email"
                  required
                />
              </div>
              <div class="form-group">
                <label for="mobile">Mobile</label>
                <input
                  type="text"
                  class="form-control"
                  id="mobile"
                  name="mobile"
                  value="<%=userData.phone%>"
                  placeholder="Enter your mobile number"
                  required
                />
              </div>
              <div class="form-group">
                <label for="profilePicture">Profile Picture</label>
                <input
                  type="file"  
                  class="form-control-file"
                  id="profilePicture"
                  name="profilePicture"  
                />
                <small class="form-text text-muted"></small>
              </div>
              <button type="submit" class="btn btn-primary">
                Save Changes
              </button>
              <a href="/userProfile" class="btn btn-primary">Back</a>
            </form>
          </div>
        </div>

        <div class="card mb-4" id="addressDetails" style="display: none">
          <div class="d-flex align-items-center justify-content-between">
            <h3></h3>
          
          </div>
          <div class="card-body">
            <h5 class="card-title">Address Details</h5>
            <hr />
            <% addAddressDetails.address.forEach((addr) => { %>
            <div id="addrId<%=addr._id%>">
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Address Line :</p>
                </div>
                <div class="col-sm-9">
                  <p class="text-muted mb-0">
                    <p class="text-muted mb-0"><%=addr.firstname%>,<%=addr.housename  %>,<%=addr.city  %>,<%=addr.district  %>,<%=addr.state  %>
                      <%=addr.pincode  %></p>
                  </p>
                </div>
              </div>
              <div class="row mt-3">
                <div class="col-sm-9 offset-sm-3">
                  <a
                  href="/addressForm?userId=<%=addAddressDetails._id  %>&addressId=<%=addr._id  %>"
                    class="btn btn-primary btn-sm mr-2"
                    >Edit</a
                  >
                  
                  <a href="" onclick="handleDeleteAddress('<%=addr._id  %>')" class="btn btn-danger btn-sm">Remove</a>
                    
                    
                </div>
              </div>
            </div>
            <hr />
            <% }) %>
          </div>
          <div class="card-body">
            <a href="/addressForm" class="btn btn-primary btn-sm"
              >Add New Address</a
            >
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Include Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>
  function toggleProfileForm() {
    var profileForm = document.getElementById('profileForm')
    var userDetails = document.getElementById('userDetails')
    var addressDetails = document.getElementById('addressDetails')
    if (profileForm.style.display === "none") {
      profileForm.style.display = "block";
      userDetails.style.display = "none";
      addressDetails.style.display = "none";
    }
    else{
      profileForm.style.display = "none";
      userDetails.style.display = "block";
    }
  }
  function toggleAddress() {
  var userDetails = document.getElementById("userDetails");
  var addressDetails = document.getElementById("addressDetails");
  var profileForm = document.getElementById("profileForm");
  if (addressDetails.style.display === "none") {
    addressDetails.style.display = "block";
      userDetails.style.display = "none";
      profileForm.style.display = "none";

    } else {
      addressDetails.style.display = "none";
      userDetails.style.display = "block";
    }
}
</script>
<script>
  const handleDeleteAddress = async (addressId) => {
    try {
     
      event.preventDefault();

      // Display the confirmation message
      swal({
        title: "Are you sure?",
        text: "Once deleted, you will not be able to recover this address!",
        icon: "warning",
        buttons: ["Cancel", "OK"],
        dangerMode: true,
      }).then(async (willDelete) => {
        if (willDelete) {
          // User clicked "OK" button, perform the delete action
          const deleteItem = await axios.put('/deleteAddress', { addressId });

          if (deleteItem.data.success===true) {
            // Remove the deleted element from the DOM
            const elementToRemove = document.getElementById(`addrId${addressId}`);
            elementToRemove.parentNode.removeChild(elementToRemove);
          }
        }
      });
    } catch (error) {
      console.log(error.message);
    }
  };
</script>

<%- include("../layouts/footer.ejs") %> 
<%- include("../layouts/userFooter.ejs")%>

